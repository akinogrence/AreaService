
--https://onecompiler.com/postgresql/3z2u8he86	adresinde test edebilirsiniz.
--POSTGRESQL için yazılmıştır.


--TABLE CREATE SCRIPTI
CREATE TABLE IN_OUT_RECORD (
    LAST_NAME varchar(255),
    FIST_NAME varchar(255),
    IN_DATE timestamp,
  	OUT_DATE timestamp,
  	RECORD_DATE date
  );

  
--TEST DATALARI
INSERT INTO IN_OUT_RECORD (FIST_NAME, LAST_NAME, IN_DATE, OUT_DATE ,RECORD_DATE)
VALUES ('akin', 'ogrence', '2023-03-15 09:10','2023-03-15 09:25' ,'2023-03-15');

INSERT INTO IN_OUT_RECORD (FIST_NAME, LAST_NAME, IN_DATE, OUT_DATE,RECORD_DATE)
VALUES ('akin', 'ogrence', '2023-03-16 09:59','2023-03-16 10:09','2023-03-16');

INSERT INTO IN_OUT_RECORD (FIST_NAME, LAST_NAME, IN_DATE, OUT_DATE,RECORD_DATE)
VALUES ('akin', 'ogrence', '2023-03-16 14:59','2023-03-16 15:00','2023-03-16');

  INSERT INTO IN_OUT_RECORD (FIST_NAME, LAST_NAME, IN_DATE, OUT_DATE,RECORD_DATE)
VALUES ('meltem', 'ogrence', '2023-03-16 09:15','2023-03-16 09:19','2023-03-16');

INSERT INTO IN_OUT_RECORD (FIST_NAME, LAST_NAME, IN_DATE, OUT_DATE,RECORD_DATE)
VALUES ('meltem', 'ogrence', '2023-03-16 09:21','2023-03-16 10:09','2023-03-16');

INSERT INTO IN_OUT_RECORD (FIST_NAME, LAST_NAME, IN_DATE, OUT_DATE,RECORD_DATE)
VALUES ('meltem', 'ogrence', '2023-03-16 14:59','2023-03-16 16:19','2023-03-16');


--SORGULANMAK ISTENEN  HER BIR KISININ KAC DAKIKA CALISTIGINI (elapsed_time_minutes_in_work) VE 8 SAATI GECEN MESAI DURUMU OLUP OLMADIGINI(shift_over_480m) GOSTEREN SQL
SELECT FIST_NAME,LAST_NAME ,RECORD_DATE AS SHIFT_DATE,
  SUM(DATE_PART('day',  OUT_DATE::timestamp - IN_DATE::timestamp)*24 + DATE_PART('hour',  OUT_DATE::timestamp - IN_DATE::timestamp)*60 + DATE_PART('minute',  OUT_DATE::timestamp - IN_DATE::timestamp)) AS ELAPSED_TIME_MINUTES_IN_WORK,
  SUM(DATE_PART('day',  OUT_DATE::timestamp - IN_DATE::timestamp)*24 + DATE_PART('hour',  OUT_DATE::timestamp - IN_DATE::timestamp)*60 + DATE_PART('minute',  OUT_DATE::timestamp - IN_DATE::timestamp))>480 AS SHIFT_OVER_480M
  FROM IN_OUT_RECORD   GROUP BY FIST_NAME,LAST_NAME , RECORD_DATE
